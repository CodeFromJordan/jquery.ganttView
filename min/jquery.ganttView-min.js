!function(e){function a(a){function t(){var a=Math.floor(r.slideWidth/r.cellWidth+5),t=s.getBoundaryDatesFromData(r.data,a);console.log("build"),console.log(t),r.start=t[0],r.end=t[1],l.each(function(){var a=e(this),t=e("<div>",{"class":"ganttview"});new o(t,r).render(),a.append(t);var l=e("div.ganttview-vtheader",a).outerWidth()+e("div.ganttview-slide-container",a).outerWidth();a.css("width",l+2+"px"),new n(a,r).apply()})}var l=this,i={showWeekends:!0,cellWidth:6,cellHeight:31,slideWidth:400,vHeaderWidth:100,behavior:{clickable:!0,draggable:!0,resizable:!0}},r=e.extend(!0,i,a);r.data?t():r.dataUrl&&e.getJSON(r.dataUrl,function(e){r.data=e,t()})}function t(e,a){if(console.log("handleMethod"),console.log(e),console.log(a),"setSlideWidth"==e){var t=$("div.ganttview",this);t.each(function(){var e=$("div.ganttview-vtheader",t).outerWidth();$(t).width(e+a+1),$("div.ganttview-slide-container",this).width(a)})}}e.fn.ganttView=function(){var e=Array.prototype.slice.call(arguments);console.log("ganttView"),console.log(e),1==e.length&&"object"==typeof e[0]&&a.call(this,e[0]),2==e.length&&"string"==typeof e[0]&&t.call(this,e[0],e[1])};var o=function(a,t){function o(){l(a,t.data,t.cellHeight);var o=e("<div>",{"class":"ganttview-slide-container",css:{width:t.slideWidth+"px"}});dates=n(t.start,t.end),r(o,dates,t.cellWidth),d(o,t.data,dates,t.cellWidth,t.showWeekends),c(o,t.data),g(o,t.data,t.cellWidth,t.start),a.append(o),f(a.parent())}function n(e,a){console.log("getDates"),console.log(e),console.log(a);var t=[];t[e.getFullYear()]=[],t[e.getFullYear()][e.getMonth()]=[e];for(var o=e;-1==o.compareTo(a);){var n=o.clone().addDays(1);t[n.getFullYear()]||(t[n.getFullYear()]=[]),t[n.getFullYear()][n.getMonth()]||(t[n.getFullYear()][n.getMonth()]=[]),t[n.getFullYear()][n.getMonth()].push(n),o=n}return t}function l(a,t,o){for(var n=e("<div>",{"class":"ganttview-vtheader"}),l=0;l<t.length;l++){var i=e("<div>",{"class":"ganttview-vtheader-item"});i.append(e("<div>",{"class":"ganttview-vtheader-item-name",css:{height:t[l].series.length*o+"px"}}).append(t[l].name));for(var s=e("<div>",{"class":"ganttview-vtheader-series"}),r=0;r<t[l].series.length;r++)s.append(e("<div>",{"class":"ganttview-vtheader-series-name"}).append(t[l].series[r].name));i.append(s),n.append(i)}a.append(n)}function r(a,t,o){var n=e("<div>",{"class":"ganttview-hzheader"}),l=e("<div>",{"class":"ganttview-hzheader-months"}),s=e("<div>",{"class":"ganttview-hzheader-days"}),r=0;for(var d in t)for(var c in t[d])for(var g in t[d][c]){var v=24*(4*o);r+=v;var p=Date.parse(t[d][c][g]);for(l.append(e("<div>",{"class":"ganttview-hzheader-month",css:{width:v-1+"px"}}).append(p.toString("ddd MMM dS"))),h=0;h<2;h++)for(i=1;i<13;i++)s.append(e("<div>",{"class":"ganttview-hzheader-day"}).append(i))}l.css("width",r+"px"),s.css("width",r+"px"),n.append(l).append(s),a.append(n)}function d(a,t,o,n,l){var i=e("<div>",{"class":"ganttview-grid"}),s=e("<div>",{"class":"ganttview-grid-row"});for(var r in o)for(var d in o[r])for(var c in o[r][d])for(p=0,h=0;h<4;h++)for(f=1;13>f;f++){var g=e("<div>",{"class":"ganttview-grid-row-cell"});1==p&&g.addClass("ganttview-weekend"),s.append(g),12==f&&1==p?p=0:12==f&&(p=1)}var v=e("div.ganttview-grid-row-cell",s).length*(2*n);s.css("width",v+"px"),i.css("width",v+"px");for(var f=0;f<t.length;f++)for(var u=0;u<t[f].series.length;u++)i.append(s.clone());a.append(i)}function c(a,t){console.log("addBlockContainers"),console.log(a),console.log(t);for(var o=e("<div>",{"class":"ganttview-blocks"}),n=0;n<t.length;n++)for(var l=0;l<t[n].series.length;l++)o.append(e("<div>",{"class":"ganttview-block-container"}));a.append(o)}function g(a,t,o,n){console.log("addBlocks"),console.log(a),console.log(t),console.log(n);for(var l=e("div.ganttview-blocks div.ganttview-block-container",a),i=0,r=0;r<t.length;r++)for(var d=0;d<t[r].series.length;d++){var c=t[r].series[d],g=s.daysBetween(c.start,c.end)+1,h=s.daysBetween(n,c.start),p=e("<div>",{"class":"ganttview-block",title:c.name+", "+g+" days",css:{width:g*o-9+"px","margin-left":h*o+3+"px"}});v(p,t[r],c),t[r].series[d].color&&p.css("background-color",t[r].series[d].color),p.append(e("<div>",{"class":"ganttview-block-text"}).html(g+" Hrs")),e(l[i]).append(p),i+=1}}function v(a,t,o){var n={id:t.id,name:t.name};e.extend(n,o),a.data("block-data",n)}function f(a){e("div.ganttview-grid-row div.ganttview-grid-row-cell:last-child",a).addClass("last"),e("div.ganttview-hzheader-days div.ganttview-hzheader-day:last-child",a).addClass("last"),e("div.ganttview-hzheader-months div.ganttview-hzheader-month:last-child",a).addClass("last")}console.log("chart"),console.log(a),console.log(t);var u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],w=["Mon","Tues","Wed","Thurs","Fri","Sat","Sun"];return{render:o}},n=function(a,t){function o(){t.behavior.clickable&&n(a,t.behavior.onClick),t.behavior.resizable&&l(a,t.cellWidth,t.start,t.behavior.onResize),t.behavior.draggable&&i(a,t.cellWidth,t.start,t.behavior.onDrag)}function n(a,t){console.log("bindBlockClick"),console.log(a),console.log(t),e("div.ganttview-block",a).live("click",function(){t&&t(e(this).data("block-data"))})}function l(a,t,o,n){console.log("bindBlockResize"),console.log(a),console.log(t),console.log(o),console.log(n),e("div.ganttview-block",a).resizable({grid:t,handles:"e,w",stop:function(){var l=e(this);s(a,l,t,o),n&&n(l.data("block-data"))}})}function i(a,t,o,n){console.log("bindBlockDrag"),console.log(a),console.log(t),console.log(o),console.log(n),e("div.ganttview-block",a).draggable({axis:"x",grid:[t,t],stop:function(){var l=e(this);s(a,l,t,o),n&&n(l.data("block-data"))}})}function s(a,t,o,n){console.log("updateDataAndPosition"),console.log(a),console.log(t),console.log(o),console.log(n);var l=e("div.ganttview-slide-container",a),i=l.scrollLeft(),s=t.offset().left-l.offset().left-1+i,r=Math.round(s/o),d=n.clone().addDays(r);t.data("block-data").start=d;var c=t.outerWidth(),g=Math.round(c/o)-1;t.data("block-data").end=d.clone().addDays(g),e("div.ganttview-block-text",t).text(g+1),t.css("top","").css("left","").css("position","relative").css("margin-left",s+"px")}return console.log("Behavior"),console.log(a),console.log(t),{apply:o}},l={contains:function(e,a){console.log("ArrayUtils"),console.log(e),console.log(a);for(var t=!1,o=0;o<e.length;o++)e[o]==a&&(t=!0);return t}},s={daysBetween:function(e,a){if(!e||!a)return 0;if(e=Date.parse(e),a=Date.parse(a),1901==e.getYear()||8099==a.getYear())return 0;for(var t=0,o=e.clone();-1==o.compareTo(a);)t+=1,o.addDays(1);return t},isWeekend:function(e){return e.getDay()%6==0},getBoundaryDatesFromData:function(e,a){console.log("getBoundaryDatesFromData");var t=new Date;maxEnd=new Date;for(var o=0;o<e.length;o++)for(var n=0;n<e[o].series.length;n++){var l=Date.parse(e[o].series[n].start),i=Date.parse(e[o].series[n].end);0==o&&0==n&&(t=l,maxEnd=i),1==t.compareTo(l)&&(t=l),-1==maxEnd.compareTo(i)&&(maxEnd=i)}return s.daysBetween(t,maxEnd)<a,console.log(t),console.log(maxEnd),[t,maxEnd]}}}(jQuery);