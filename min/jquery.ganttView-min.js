!function(e){function t(t){function a(){var t=Math.floor(r.slideWidth/r.cellWidth+5),a=s.getBoundaryDatesFromData(r.data,t);console.log("build"),console.log(a),r.start=a[0],r.end=a[1],l.each(function(){var t=e(this),a=e("<div>",{"class":"ganttview"});new o(a,r).render(),t.append(a);var l=e("div.ganttview-vtheader",t).outerWidth()+e("div.ganttview-slide-container",t).outerWidth();t.css("width",l+2+"px"),new n(t,r).apply()})}var l=this,i={showWeekends:!0,cellWidth:6,cellHeight:31,slideWidth:400,vHeaderWidth:100,behavior:{clickable:!0,draggable:!0,resizable:!0}},r=e.extend(!0,i,t);r.data?a():r.dataUrl&&e.getJSON(r.dataUrl,function(e){r.data=e,a()})}function a(e,t){if(console.log("handleMethod"),console.log(e),console.log(t),"setSlideWidth"==e){var a=$("div.ganttview",this);a.each(function(){var e=$("div.ganttview-vtheader",a).outerWidth();$(a).width(e+t+1),$("div.ganttview-slide-container",this).width(t)})}}e.fn.ganttView=function(){var e=Array.prototype.slice.call(arguments);console.log("ganttView"),console.log(e),1==e.length&&"object"==typeof e[0]&&t.call(this,e[0]),2==e.length&&"string"==typeof e[0]&&a.call(this,e[0],e[1])};var o=function(t,a){function o(){l(t,a.data,a.cellHeight);var o=e("<div>",{"class":"ganttview-slide-container",css:{width:a.slideWidth+"px"}});dates=n(a.start,a.end),r(o,dates,a.cellWidth),d(o,a.data,dates,a.cellWidth,a.showWeekends),c(o,a.data),g(o,a.data,a.cellWidth,a.start),t.append(o),f(t.parent())}function n(e,t){console.log("getDates"),console.log(e),console.log(t);var a=[];a[e.getFullYear()]=[],a[e.getFullYear()][e.getMonth()]=[e];for(var o=e;-1==o.compareTo(t);){var n=o.clone().addDays(1);a[n.getFullYear()]||(a[n.getFullYear()]=[]),a[n.getFullYear()][n.getMonth()]||(a[n.getFullYear()][n.getMonth()]=[]),a[n.getFullYear()][n.getMonth()].push(n),o=n}return a}function l(t,a,o){for(var n=e("<div>",{"class":"ganttview-vtheader"}),l=0;l<a.length;l++){var i=e("<div>",{"class":"ganttview-vtheader-item"});i.append(e("<div>",{"class":"ganttview-vtheader-item-name",css:{height:a[l].series.length*o+"px"}}).append(a[l].name));for(var s=e("<div>",{"class":"ganttview-vtheader-series"}),r=0;r<a[l].series.length;r++)s.append(e("<div>",{"class":"ganttview-vtheader-series-name"}).append(a[l].series[r].name));i.append(s),n.append(i)}t.append(n)}function r(t,a,o){var n=e("<div>",{"class":"ganttview-hzheader"}),l=e("<div>",{"class":"ganttview-hzheader-months"}),s=e("<div>",{"class":"ganttview-hzheader-days"}),r=0;for(var d in a)for(var c in a[d])for(var g in a[d][c]){var v=24*(4*o);r+=v;var p=Date.parse(a[d][c][g]);for(l.append(e("<div>",{"class":"ganttview-hzheader-month",css:{width:v-1+"px"}}).append(p.toString("ddd MMM dS"))),h=0;h<2;h++)for(i=1;i<13;i++)s.append(e("<div>",{"class":"ganttview-hzheader-day"}).append(i))}l.css("width",r+"px"),s.css("width",r+"px"),n.append(l).append(s),t.append(n)}function d(t,a,o,n,l){var i=e("<div>",{"class":"ganttview-grid"}),s=e("<div>",{"class":"ganttview-grid-row"});for(var r in o)for(var d in o[r])for(var c in o[r][d])for(p=0,h=0;h<4;h++)for(f=1;13>f;f++){var g=e("<div>",{"class":"ganttview-grid-row-cell"});1==p&&g.addClass("ganttview-weekend"),s.append(g),12==f&&1==p?p=0:12==f&&(p=1)}var v=e("div.ganttview-grid-row-cell",s).length*(2*n);s.css("width",v+"px"),i.css("width",v+"px");for(var f=0;f<a.length;f++)for(var u=0;u<a[f].series.length;u++)i.append(s.clone());t.append(i)}function c(t,a){console.log("addBlockContainers"),console.log(t),console.log(a);for(var o=e("<div>",{"class":"ganttview-blocks"}),n=0;n<a.length;n++)for(var l=0;l<a[n].series.length;l++)o.append(e("<div>",{"class":"ganttview-block-container"}));t.append(o)}function g(t,a,o,n){console.log("addBlocks"),console.log(t),console.log(a),console.log(n);for(var l=e("div.ganttview-blocks div.ganttview-block-container",t),i=0,r=0;r<a.length;r++)for(var d=0;d<a[r].series.length;d++){var c=a[r].series[d],g=s.daytimeBetween(c.start,c.end)+1,h=s.daytimeBetween(n,c.start);console.log(g),console.log(h);var p=e("<div>",{"class":"ganttview-block",title:c.name+", "+g+" days",css:{width:g*o-3+"px","margin-left":h*o+"px"}});v(p,a[r],c),a[r].series[d].color&&p.css("background-color",a[r].series[d].color),textdate=15*g/60+" Hours",p.append(e("<div>",{"class":"ganttview-block-text"}).html(textdate)),e(l[i]).append(p),i+=1}}function v(t,a,o){var n={id:a.id,name:a.name};e.extend(n,o),t.data("block-data",n)}function f(t){e("div.ganttview-grid-row div.ganttview-grid-row-cell:last-child",t).addClass("last"),e("div.ganttview-hzheader-days div.ganttview-hzheader-day:last-child",t).addClass("last"),e("div.ganttview-hzheader-months div.ganttview-hzheader-month:last-child",t).addClass("last")}console.log("chart"),console.log(t),console.log(a);var u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],w=["Mon","Tues","Wed","Thurs","Fri","Sat","Sun"];return{render:o}},n=function(t,a){function o(){a.behavior.clickable&&n(t,a.behavior.onClick),a.behavior.resizable&&l(t,a.cellWidth,a.start,a.behavior.onResize),a.behavior.draggable&&i(t,a.cellWidth,a.start,a.behavior.onDrag)}function n(t,a){console.log("bindBlockClick"),console.log(t),console.log(a),e("div.ganttview-block",t).live("click",function(){a&&a(e(this).data("block-data"))})}function l(t,a,o,n){console.log("bindBlockResize"),console.log(t),console.log(a),console.log(o),console.log(n),e("div.ganttview-block",t).resizable({grid:a,handles:"e,w",stop:function(){var l=e(this);s(t,l,a,o),n&&n(l.data("block-data"))}})}function i(t,a,o,n){console.log("bindBlockDrag"),console.log(t),console.log(a),console.log(o),console.log(n),e("div.ganttview-block",t).draggable({axis:"x",grid:[a,a],stop:function(){var l=e(this);s(t,l,a,o),n&&n(l.data("block-data"))}})}function s(t,a,o,n){console.log("updateDataAndPosition"),console.log(t),console.log(a),console.log(o),console.log(n);var l=e("div.ganttview-slide-container",t),i=l.scrollLeft(),s=a.offset().left-l.offset().left-1+i,r=Math.round(s/o),d=n.clone().addDays(r);a.data("block-data").start=d;var c=a.outerWidth(),g=Math.round(c/o);a.data("block-data").end=d.clone().addMinutes(15*g),textdate=15*g/60+" Hours",e("div.ganttview-block-text",a).text(textdate),a.css("top","").css("left","").css("position","relative").css("margin-left",s+"px")}return console.log("Behavior"),console.log(t),console.log(a),{apply:o}},l={contains:function(e,t){console.log("ArrayUtils"),console.log(e),console.log(t);for(var a=!1,o=0;o<e.length;o++)e[o]==t&&(a=!0);return a}},s={daysBetween:function(e,t){if(!e||!t)return 0;if(e=Date.parse(e),t=Date.parse(t),1901==e.getYear()||8099==t.getYear())return 0;for(var a=0,o=e.clone();-1==o.compareTo(t);)a+=1,o.addDays(1);return a},daytimeBetween:function(e,t){if(!e||!t)return 0;if(e=Date.parse(e),t=Date.parse(t),1901==e.getYear()||8099==t.getYear())return 0;for(var a=0,o=e.clone();-1==o.compareTo(t);)a+=1,o.addMinutes(45);return a},isWeekend:function(e){return e.getDay()%6==0},getBoundaryDatesFromData:function(e,t){var a=new Date;maxEnd=new Date;for(var o=0;o<e.length;o++)for(var n=0;n<e[o].series.length;n++){var l=Date.parse(e[o].series[n].start),i=Date.parse(e[o].series[n].end);0==o&&0==n&&(a=l,maxEnd=i),1==a.compareTo(l)&&(a=l),-1==maxEnd.compareTo(i)&&(maxEnd=i)}return s.daysBetween(a,maxEnd)<t,[a,maxEnd]}}}(jQuery);